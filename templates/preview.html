{% extends 'layouts/_questionnaire.html' %}
{% from 'macros/helpers.html' import format_paragraphs %}

{% from 'macros/helpers.html' import interviewer_note %}

{% from "components/accordion/_macro.njk" import onsAccordion %}

{% from "components/summary/_macro.njk" import onsSummary %}

{% set save_on_signout = true %}

{% set continue_button_text = _("Continue") %}


{% from "components/panel/_macro.njk" import onsPanel %}




{% block main %}

<h2>Preview of the questions in this survey</h2>

{{
  onsPanel({
    "body": '<p>To answer these questions you need to <a href="/questionnaire">start survey</a></p>'
  })
}}

<br>
<p>You may not have to answer all of these questions. The questions you see will depend on the answers you provide.</p>

{{
  onsButton({
    "type": 'button',
    "text": _('Print questions'),
    "buttonStyle": "print",
    "variants": ['small', 'secondary'],
    "attributes": {
      "data-qa": "btn-print"
    }
  })
}}
{{
  onsButton({
    "buttonStyle": 'download',
    "text": _('Save answers as PDF'),
    "submitType": "timer",
    "variants": ['small', 'secondary'],
    "url": content.pdf_url,
    "removeDownloadAttribute": true,
    "attributes": {
      "data-qa": "btn-pdf"
    }
  })
}}

{%- set itemList = [] -%}

<div class="ons-u-mt-l ons-u-mb-l">

  {%- for group in content.summary.groups -%}
  {%- if group["blocks"] | length -%}
      {%- set item = {
        "title": group.title or "No title provided",
        "id": group.id,
        "content": "",
        "button": {
          "open": _('Show'),
          "close": _('Hide'),
          "attributes": {
            "data-ga": "click",
            "data-ga-category": "Preview Survey",
            "data-ga-action": "Open panel",
            "data-ga-label": group.title
          }
        }
      } -%}

      {%- set group %}
        {% for block in group["blocks"] %}
          {% if 'question' in block %}
            {% set question = block['question'] %}
            {% include 'partials/preview-question.html' %}
          {% endif %}
        {% endfor %}
      {%- endset -%}


      {%- do item | setAttribute("content", item.content + group) -%}

      {%- do itemList.append(item) -%}
  {%- endif -%}
{%- endfor -%}

{{ onsAccordion({
  "id": "summary-accordion",
  "allButton": {
      "open": _('Show all'),
      "close": _('Hide all'),
      "attributes": {
        "data-ga": "click",
        "data-ga-category": "Preview Survey",
        "data-ga-action": "Show all",
        "data-ga-label": "Show all"
      }
  },
  "itemsList": itemList
}) }}


</div>




{% endblock main %}

