{
    "mime_type": "application/json/ons/eq",
    "language": "en",
    "schema_version": "0.0.1",
    "data_version": "0.0.3",
    "survey_id": "0",
    "title": "Grand Calculated Summary with overlapping answers",
    "theme": "default",
    "description": "A schema to showcase grand calculated summaries which include multiple calculated summaries using the same answers. The idea here is that you provide 4 answers on charity donations, that sum up to a total personal donation, and then these answers are re-used in a different calculated summary that sums up how much your job contributes. The final grand calculated summary includes the sum of all your answers, and it may sum up some answers twice, if they are also included in the job match calculated summary. (E.g. if you donate £10 to charity A, and your job matches it, that totals a donation of £20, summing your answer twice)",
    "metadata": [
        {
            "name": "user_id",
            "type": "string"
        },
        {
            "name": "period_id",
            "type": "string"
        },
        {
            "name": "ru_name",
            "type": "string"
        }
    ],
    "questionnaire_flow": {
        "type": "Hub",
        "options": {
            "required_completed_sections": ["introduction-section"]
        }
    },
    "sections": [
        {
            "id": "introduction-section",
            "title": "Introduction",
            "show_on_hub": false,
            "groups": [
                {
                    "id": "introduction-group",
                    "title": "Introduction",
                    "blocks": [
                        {
                            "type": "Introduction",
                            "id": "introduction-block",
                            "primary_content": [
                                {
                                    "id": "about",
                                    "contents": [
                                        {
                                            "title": "About",
                                            "list": [
                                                "This survey tests that when you re-use answers between calculated summaries, the grand calculated summary still resolves to the correct value"
                                            ]
                                        },
                                        {
                                            "title": "How to test this schema",
                                            "list": [
                                                "When you select that your job matches donations, it unlocks one of two new calculated summaries which reuses your answers to the first two questions to produce an additional sum for what your job contributes",
                                                "In the case that you pick `my job does not match donations` verify that you do not see a calculated summary about job donations",
                                                "In the case that you pick one of the other options, verify that the grand calculated summary includes the correct answers, especially those which are on the path and used by a calculated summary that is not on the path",
                                                "e.g. if you donate a total of £100 to charity A and £100 to charity B, and your job matches all donations, you should see a total of £400 on the grand calculated summary page",
                                                "Additionally, verify that if you use a change link on a grand calculated summary, to edit an answer that is in two calculated summaries, you are routed to each of these calculated summaries to re-confirm them first, and only then taken back to the grand calculated summary, <strong>regardless of which of the calculated summary change links you used to edit the answer</strong>."
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "id": "section-1",
            "title": "Charity donations",
            "summary": {
                "show_on_completion": true
            },
            "groups": [
                {
                    "id": "group-1",
                    "title": "Group title for charity donations",
                    "blocks": [
                        {
                            "type": "Question",
                            "id": "block-1",
                            "question": {
                                "type": "General",
                                "id": "question-1",
                                "title": "How much did you donate to charity last month?",
                                "answers": [
                                    {
                                        "id": "q1-a1",
                                        "label": "Donation to Charity A last month",
                                        "type": "Currency",
                                        "currency": "GBP",
                                        "mandatory": false
                                    },
                                    {
                                        "id": "q1-a2",
                                        "label": "Donation to Charity B last month",
                                        "type": "Currency",
                                        "currency": "GBP",
                                        "mandatory": false
                                    }
                                ]
                            }
                        },
                        {
                            "type": "Question",
                            "id": "block-2",
                            "question": {
                                "type": "General",
                                "id": "question-2",
                                "title": "How much will you donate to charity this month?",
                                "answers": [
                                    {
                                        "id": "q2-a1",
                                        "label": "Donation to Charity A this month",
                                        "type": "Currency",
                                        "currency": "GBP",
                                        "mandatory": false
                                    },
                                    {
                                        "id": "q2-a2",
                                        "label": "Donation to Charity B this month",
                                        "type": "Currency",
                                        "currency": "GBP",
                                        "mandatory": false
                                    }
                                ]
                            }
                        },
                        {
                            "type": "CalculatedSummary",
                            "id": "calculated-summary-1",
                            "title": "Total donations to Charity A is calculated to be %(total)s. Is this correct?",
                            "calculation": {
                                "title": "Total donations to Charity A",
                                "operation": {
                                    "+": [
                                        {
                                            "source": "answers",
                                            "identifier": "q1-a1"
                                        },
                                        {
                                            "source": "answers",
                                            "identifier": "q2-a1"
                                        }
                                    ]
                                }
                            }
                        },
                        {
                            "type": "CalculatedSummary",
                            "id": "calculated-summary-2",
                            "title": "Total donations to Charity B is calculated to be %(total)s. Is this correct?",
                            "calculation": {
                                "title": "Total donations to Charity B",
                                "operation": {
                                    "+": [
                                        {
                                            "source": "answers",
                                            "identifier": "q1-a2"
                                        },
                                        {
                                            "source": "answers",
                                            "identifier": "q2-a2"
                                        }
                                    ]
                                }
                            }
                        },
                        {
                            "type": "Question",
                            "id": "block-3",
                            "question": {
                                "type": "General",
                                "id": "question-3",
                                "title": "Does your job match any donation amount? This determines which calculated summary you see next (if any)",
                                "guidance": {
                                    "contents": [
                                        {
                                            "description": "If you select the first option, all your answers so far will be reused in a new calculated summary for matching donations. If you select the second option, only your answers for donations to question 2 will be reused."
                                        }
                                    ]
                                },
                                "answers": [
                                    {
                                        "type": "Radio",
                                        "id": "radio-funding",
                                        "mandatory": true,
                                        "options": [
                                            {
                                                "label": "Yes, for every donation my job contributes an equal amount",
                                                "value": "AB"
                                            },
                                            {
                                                "label": "My job will only match donations made this month",
                                                "value": "A"
                                            },
                                            {
                                                "label": "No",
                                                "value": "No"
                                            }
                                        ]
                                    }
                                ]
                            }
                        },
                        {
                            "skip_conditions": {
                                "when": {
                                    "!=": [
                                        {
                                            "source": "answers",
                                            "identifier": "radio-funding"
                                        },
                                        "AB"
                                    ]
                                }
                            },
                            "type": "CalculatedSummary",
                            "id": "calculated-summary-3",
                            "title": "Total donations to match is calculated to be %(total)s. Is this correct? This reuses your answers to question 1 and 2",
                            "calculation": {
                                "title": "Total matched donation (reusing answers from question 1 and 2)",
                                "operation": {
                                    "+": [
                                        {
                                            "source": "answers",
                                            "identifier": "q1-a1"
                                        },
                                        {
                                            "source": "answers",
                                            "identifier": "q1-a2"
                                        },
                                        {
                                            "source": "answers",
                                            "identifier": "q2-a1"
                                        },
                                        {
                                            "source": "answers",
                                            "identifier": "q2-a2"
                                        }
                                    ]
                                }
                            }
                        },
                        {
                            "skip_conditions": {
                                "when": {
                                    "!=": [
                                        {
                                            "source": "answers",
                                            "identifier": "radio-funding"
                                        },
                                        "A"
                                    ]
                                }
                            },
                            "type": "CalculatedSummary",
                            "id": "calculated-summary-4",
                            "title": "Total donations this month to match is calculated to be %(total)s. Is this correct? This is reusing your answers to question 2",
                            "calculation": {
                                "title": "Total matched donation (reusing answers from question 2)",
                                "operation": {
                                    "+": [
                                        {
                                            "source": "answers",
                                            "identifier": "q2-a1"
                                        },
                                        {
                                            "source": "answers",
                                            "identifier": "q2-a2"
                                        }
                                    ]
                                }
                            }
                        }
                    ]
                }
            ]
        },
        {
            "id": "section-3",
            "title": "Grand calculated summary",
            "groups": [
                {
                    "id": "group-2",
                    "title": "Grand calculated summary of donations",
                    "blocks": [
                        {
                            "type": "GrandCalculatedSummary",
                            "id": "grand-calculated-summary-donations",
                            "title": "Grand Calculated Summary of donations is calculated to be %(total)s. Is this correct? The total matched donation (if present) uses the same answers as the other two calculated summaries, so these answers are summed up twice in the total.",
                            "calculation": {
                                "title": "Total donations to charity",
                                "operation": {
                                    "+": [
                                        {
                                            "source": "calculated_summary",
                                            "identifier": "calculated-summary-1"
                                        },
                                        {
                                            "source": "calculated_summary",
                                            "identifier": "calculated-summary-2"
                                        },
                                        {
                                            "source": "calculated_summary",
                                            "identifier": "calculated-summary-3"
                                        },
                                        {
                                            "source": "calculated_summary",
                                            "identifier": "calculated-summary-4"
                                        }
                                    ]
                                }
                            }
                        }
                    ]
                }
            ]
        }
    ]
}
